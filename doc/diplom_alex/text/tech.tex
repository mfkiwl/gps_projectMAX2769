\section{ТЕХНОЛОГИЧЕСКИЙ РАЗДЕЛ}

\subsection{Описание аппаратной платформы для приема сигналов GPS}

\begin{figure}[H]
\center{\includegraphics[width=1\linewidth]{./pics/board_scheme.eps}}
\caption{Системы захвата данных}
\label{pic:board_scheme}
\end{figure}

\subsection{Описание разработанных встраиваемых решений (VHDL)}

%=====================================================================
\subsubsection{Арбитр GPS-Board}
Арбитр платы выполняет основную управляющую функцию. Внутри арбитра происходит разбор пришедших по RS-232 команд, определяется
модуль, который будет управлять SRAM, осуществляется координация действий всех остальных модулей. Архитектура модуля представлена на
рисунке \ref{pic:arbiter_arch}.

\begin{figure}[H]
\begin{center}
	\scalebox{0.3}{\includegraphics[width=1\linewidth]{./pics/arbiter_arch.eps}}
\end{center}
\caption{Арбитр GPS-Board}
\label{pic:arbiter_arch}
\end{figure}

Сигнал mode[1:0] управляет мультиплексором, который определяет модуль, получающий доступ к SRAM. 

Так же арбитер управляет записью в SRAM клиентских данных и выдачей содержимого SRAM через RS-232 клиенту. Для этого используются
сигналы rw, mem, data\_f2s[7:0], data\_s2f[7:0], addr\_a[17:0]. Арбитр устанавливает сигнал mode[1:0] в соостояние соответствующее
тому, что он управляет SRAM и начинает цикл чтения/записи. После получения сигнала ready цикл чтения/записи считается завершенным
и данные записанными/валидными.

Модуль захвата GNSS сигнала управляется сигналом gps\_start\_a.
При получении команды по RS-232 на захват данных, сигнал gps\_start\_a выставляется
и арбитер переходит в режим ожидания сигнала gps\_done\_a, символизирующего окончания захвата (заполнение микросхемы памяти).
Арбитр, получив данный сигнал, отправляет ответ по RS-232 об успешном захвате. Подробнее модуль захвата рассмотрен в разделе
\ref{sec:gps_acq}

Сигналы cs\_a, sclk\_a, sdata\_a используются для программирования микросхемы MAX2769. Модуль программирования данной микросхемы
описан внутри модуля арбитра, поэтому все сигналы управления являются внутренними относительно арбитра и не представлены на рисунке
\ref{pic:arbiter_arch}. Подробнее модуль программирования микросхемы GPS рассмотрен в разделе \ref{sec:gps_program}.

Сигнал test\_mem управляет модуль тестирования памяти. Получив команду тестирования, арбитр переходит в режим ожидания окончания теста.
Двух битная шина test\_result[1:0] возвращает результат тестирования в арбитр. Арбитр анализирует ответ и возвращает результат 
через RS-232 интерфейс клиенту. Подробнее модуль тестирования рассмотрен в разделе \ref{sec:test_sram}

\subsubsection{RS-232}
\label{razdel3_rs232}
Для реализации интерфейса RS232 на данной плате необходимо разработать делитель частоты, так как самым быстрым режимом передачи данных
для RS-232 порта является скороть 115200 б/c. Так же необходимо реализовать прием команд длинной 64 бита, чтобы обеспечить
полный функционал (программирование GPS-микросхемы, запись в память, управление платой).

\subsubsection{Контроллер для SRAM-микросхемы M5M5V208FP-85}
\label{sec:sram_controller}
Контроллер микросхемы памяти был реализован на VHDL. Структурная схема представлена на рисунке \ref{pic:sram_arch}.

\begin{figure}[H]
\begin{center}
	\scalebox{0.5}{\includegraphics[width=1\linewidth]{./pics/sram_arch.eps}}
\end{center}
\caption{Контроллер SRAM-памяти}
\label{pic:sram_arch}
\end{figure}

Входной сигнал rw управляет режимами чтения/записи, преобразую заданный режим в комбинацию выходных сигналов OE, WE, s1, s2.
Шина data\_f2s[7:0] является входной шиной, через нее модули записывают данные в SRAM. Внутри модуля байт из data\_f2s
переносится в локальный сигнал и выставляется на запись в шину dio\_a[7:0]. Шина data\_f2s[7:0] мультиплексная, потому что 
у памяти есть несколько клиентов: модуль тестирования памяти, арбитр, модуль захвата сигналов GNSS. Сигнал mem сигнализирует о начале
активности. Так же мультиплексируются все сигналы задействованные при записи данных в SRAM: rw, mem\_s, addr[17:0]. Сигналом окончания
цикла чтения/записи является сигнал ready.

\subsubsection{Модуль тестирования SRAM-микросхемы M5M5V208FP-85}
\label{sec:test_sram}
Модуль тестирования реализует просто тест памяти по методике бегущего бита (walking bit). Поскольку объем памяти невелик, а скорость
достаточно высокая, возможно протестировать данным тестом всю микросхему. Суть теста заключается в том, что в каждый адрес записывается
байт всего с одной единицей, в следующий за данным адресом записывается байт со сдвинутой единицей на 1 разряд. При перенесении единицы
из 7 разряда, она вносится в 0-ой разряд. Модуль сначала записывает бегущую единицу во все ячейки, а потом считывает и сравнивает с
копией бегущей единицы. Данный тест позволяет детектировать практически все виды ошибок памяти
(надежность данного метода доказана в Phd работе, выдержки из которой доступны в \cite{fast_mem_test}):
разрыв дорожки, замыкание дорожек, отсутствие чипа, нарушение работы чипа. Архитектура модуля представлена на рисунке
\ref{pic:test_sram_arch}.

\begin{figure}[H]
\begin{center}
	\scalebox{0.5}{\includegraphics[width=1\linewidth]{./pics/test_sram_arch.eps}}
\end{center}
\caption{Контроллер SRAM-памяти}
\label{pic:test_sram_arch}
\end{figure}

Модуль находится в режиме ожидания до получения сигнала test\_mem. Выставляя данный сигнал, арбитр устанавливает данный модуль
в режим управления памятью. Получив сигнал, модуль переводит SRAM в режим записи и начинает записывать "бегущую единицу",
выставляя данные на data\_f2s[7:0], а адрес на addr\_t[17:0]. Записав все ячейки, модуль переводит SRAM в режим чтения и последовательно
считывает данные, сравнивая с "бегущей единицей". Если в процессе считывания обнаруживается ошибка, тест прекращается и 
выставляется сигнал ошибки арбитру, иначе при окончании теста арбитру выставляется сигнал об успешности теста. Арбитр возвращает
результат клиенту.

\subsubsection{Модуль захвата GNSS данных}
\label{sec:gps_acq}
Захватом GNSS данных заниматется отдельный модуль, которым через сигнал gps\_start\_m управляет арбитр. Архитектура модуля
представлена на рисунке \ref{pic:gps_main_arch}

\begin{figure}[H]
\begin{center}
	\scalebox{0.5}{\includegraphics[width=1\linewidth]{./pics/gps_main_arch.eps}}
\end{center}
\caption{Модуль захвата GNSS данных}
\label{pic:gps_main_arch}
\end{figure}

Выставляя сигнал gps\_start\_m, арбитр передает управление SRAM модулю захвата GNSS данных. Это обусловлено тем, что захват 
происходит на достаточно высокой скорости и возможно записывать данные "на лету", иначе захват будет с пропусками, а сигнал GNSS
не будет валидным. При получении сигнала модуль переходит из состояния ожидания в состояние захвата и записи данных в SRAM. 
Сигналом rw\_m микросхема переводится в режим записи, сигнал mem\_m выставляется при начале записи данных. Данные попадают
в модуль контроллера памяти, а модуль захвата переходит в состояние получения следующего байта данных. При заполении памяти
выставляется сигнал gps\_done\_m, информирующий арбитр об окончании захвата, а модуль переходит в режим ожидания. Данные с
микросхемы MAX2769 поступаю на входы q\_m[1:0] и i\_m[1:0]. За один такт микросхема выдает один полубайт (nibble), модуль
сохраняет полубайт и считывает следующий. После получения одного байта, байт выставляется для записи в контроллер памяти.

\subsubsection{Модуль программирования микросхемы MAX2769}
\label{sec:gps_program}
Микросхема компании Maxim Semiconductor MAX2769 является очень гибкой. Она может работать в большом количестве режимов.
Чтобы получить требуемый режим она должны быть запрограммирована через последовательный интефейс. Архитектура модуля
программирования микросхемы MAX2769 представлена на рисунке \ref{pic:gps_program}.

\begin{figure}[H]
\begin{center}
	\scalebox{0.5}{\includegraphics[width=1\linewidth]{./pics/gps_program.eps}}
\end{center}
\caption{Модуль программирования MAX2769}
\label{pic:gps_program}
\end{figure}

При получении сигнала program\_gps\_s от арбитра, модуль переходит из состояния ожидания в режим программирования микросхемы
MAX2769. По шине gps\_word\_s[31:0] передается 4 бита - адрес регистра внутри MAX2769, 27 бит - данные для записи в регистр.
Данный последовательный интерфейс программирования предусматривает определенные временные задержки на выдерживание данных
при выставлении на sdata\_s. Синхросигнал нужной частоты генерируется внутри данного модуля и подается на выходную линию sclk\_s.
При окончании передачи регистра по выходной линии sdata\_s, модуль посылает арбитру сигнал gps\_programmed\_s и переходит в режим
ожидания.

%==========================================================================================
\subsection{Описание прикладного программного обеспечения}
\subsubsection{ПО управляющее GPS-Board}
\label{sec:board_daemon}

\newpage
